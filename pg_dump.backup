--
-- PostgreSQL database dump
--

-- Dumped from database version 15.3 (Debian 15.3-1.pgdg110+1)
-- Dumped by pg_dump version 15.3 (Debian 15.3-1.pgdg110+1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: update_sale_total_price(); Type: FUNCTION; Schema: public; Owner: root
--

CREATE FUNCTION public.update_sale_total_price() RETURNS trigger
    LANGUAGE plpgsql
    AS $$ BEGIN
		UPDATE sales 
		SET sls_total_price = ( SELECT SUM ( sls_ite_total ) FROM sales_items WHERE sls_ite_id_sale = NEW.sls_ite_id_sale ) ,
		sls_total_price_taxes = ( SELECT SUM ( (sls_ite_tax / 100) * sls_ite_price * sls_ite_qtd ) FROM sales_items WHERE sls_ite_id_sale = NEW.sls_ite_id_sale ) 
	WHERE
		sls_id = NEW.sls_ite_id_sale;
	RETURN NEW;
	
END;

$$;


ALTER FUNCTION public.update_sale_total_price() OWNER TO root;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: products; Type: TABLE; Schema: public; Owner: root
--

CREATE TABLE public.products (
    prd_id integer NOT NULL,
    prd_id_user integer NOT NULL,
    prd_id_type integer NOT NULL,
    prd_name character varying(255) NOT NULL,
    prd_price real NOT NULL
);


ALTER TABLE public.products OWNER TO root;

--
-- Name: products_id_seq; Type: SEQUENCE; Schema: public; Owner: root
--

CREATE SEQUENCE public.products_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    MAXVALUE 2147483647
    CACHE 1;


ALTER TABLE public.products_id_seq OWNER TO root;

--
-- Name: products_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: root
--

ALTER SEQUENCE public.products_id_seq OWNED BY public.products.prd_id;


--
-- Name: products_types; Type: TABLE; Schema: public; Owner: root
--

CREATE TABLE public.products_types (
    tpo_id integer NOT NULL,
    tpo_id_user integer NOT NULL,
    tpo_description character varying(255) NOT NULL,
    tpo_tax real NOT NULL
);


ALTER TABLE public.products_types OWNER TO root;

--
-- Name: sales; Type: TABLE; Schema: public; Owner: root
--

CREATE TABLE public.sales (
    sls_id integer NOT NULL,
    sls_id_user integer NOT NULL,
    sls_client character varying(255) NOT NULL,
    sls_total_price real DEFAULT 0 NOT NULL,
    sls_date timestamp(6) without time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    sls_total_price_taxes real DEFAULT 0 NOT NULL
);


ALTER TABLE public.sales OWNER TO root;

--
-- Name: sales_items; Type: TABLE; Schema: public; Owner: root
--

CREATE TABLE public.sales_items (
    sls_ite_id integer NOT NULL,
    sls_ite_id_product integer NOT NULL,
    sls_ite_description character varying(255) NOT NULL,
    sls_ite_price real NOT NULL,
    sls_ite_qtd real NOT NULL,
    sls_ite_tax real NOT NULL,
    sls_ite_total real NOT NULL,
    sls_ite_id_sale integer NOT NULL
);


ALTER TABLE public.sales_items OWNER TO root;

--
-- Name: sales_id_ite_seq; Type: SEQUENCE; Schema: public; Owner: root
--

CREATE SEQUENCE public.sales_id_ite_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    MAXVALUE 2147483647
    CACHE 1;


ALTER TABLE public.sales_id_ite_seq OWNER TO root;

--
-- Name: sales_id_ite_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: root
--

ALTER SEQUENCE public.sales_id_ite_seq OWNED BY public.sales_items.sls_ite_id;


--
-- Name: sales_id_seq; Type: SEQUENCE; Schema: public; Owner: root
--

CREATE SEQUENCE public.sales_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    MAXVALUE 2147483647
    CACHE 1;


ALTER TABLE public.sales_id_seq OWNER TO root;

--
-- Name: sales_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: root
--

ALTER SEQUENCE public.sales_id_seq OWNED BY public.sales.sls_id;


--
-- Name: type_id_seq; Type: SEQUENCE; Schema: public; Owner: root
--

CREATE SEQUENCE public.type_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    MAXVALUE 2147483647
    CACHE 1;


ALTER TABLE public.type_id_seq OWNER TO root;

--
-- Name: type_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: root
--

ALTER SEQUENCE public.type_id_seq OWNED BY public.products_types.tpo_id;


--
-- Name: users_id_seq; Type: SEQUENCE; Schema: public; Owner: root
--

CREATE SEQUENCE public.users_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    MAXVALUE 2147483647
    CACHE 1;


ALTER TABLE public.users_id_seq OWNER TO root;

--
-- Name: users_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: root
--

ALTER SEQUENCE public.users_id_seq OWNED BY public.sales_items.sls_ite_id;


--
-- Name: users; Type: TABLE; Schema: public; Owner: root
--

CREATE TABLE public.users (
    usr_id integer DEFAULT nextval('public.users_id_seq'::regclass) NOT NULL,
    urs_username character varying(255) NOT NULL,
    urs_password character varying(255) NOT NULL,
    urs_name character varying(255) NOT NULL
);


ALTER TABLE public.users OWNER TO root;

--
-- Name: products prd_id; Type: DEFAULT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.products ALTER COLUMN prd_id SET DEFAULT nextval('public.products_id_seq'::regclass);


--
-- Name: products_types tpo_id; Type: DEFAULT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.products_types ALTER COLUMN tpo_id SET DEFAULT nextval('public.type_id_seq'::regclass);


--
-- Name: sales sls_id; Type: DEFAULT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.sales ALTER COLUMN sls_id SET DEFAULT nextval('public.sales_id_seq'::regclass);


--
-- Name: sales_items sls_ite_id; Type: DEFAULT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.sales_items ALTER COLUMN sls_ite_id SET DEFAULT nextval('public.sales_id_ite_seq'::regclass);


--
-- Data for Name: products; Type: TABLE DATA; Schema: public; Owner: root
--

COPY public.products (prd_id, prd_id_user, prd_id_type, prd_name, prd_price) FROM stdin;
1	1	1	Pimentão	8.3
2	1	3	Ponta de Peito	28.9
3	1	2	Pão Francês	32.99
4	1	1	Rúcula	5.45
5	1	1	Repolho	156.932
6	1	1	Maracujá	18.35
\.


--
-- Data for Name: products_types; Type: TABLE DATA; Schema: public; Owner: root
--

COPY public.products_types (tpo_id, tpo_id_user, tpo_description, tpo_tax) FROM stdin;
1	1	Hortifruti	31.5
2	1	Limpeza	32
3	1	Açougue	45.34
4	1	Padaria	25
5	1	Utensílios	25.3
6	1	Frios	31.12
7	1	Doces	42
\.


--
-- Data for Name: sales; Type: TABLE DATA; Schema: public; Owner: root
--

COPY public.sales (sls_id, sls_id_user, sls_client, sls_total_price, sls_date, sls_total_price_taxes) FROM stdin;
1	1	42109479892	250.92201	2023-06-19 11:33:56.597316	83.20514
2	1	Cliente sem CPF	770.494	2023-06-19 11:34:13.451562	263.0343
\.


--
-- Data for Name: sales_items; Type: TABLE DATA; Schema: public; Owner: root
--

COPY public.sales_items (sls_ite_id, sls_ite_id_product, sls_ite_description, sls_ite_price, sls_ite_qtd, sls_ite_tax, sls_ite_total, sls_ite_id_sale) FROM stdin;
1	1	Pimentão	8.3	1	31.5	8.3	1
2	2	Ponta de Peito	28.9	1	45.34	28.9	1
3	3	Pão Francês	32.99	1	32	32.99	1
4	4	Rúcula	5.45	1	31.5	5.45	1
5	5	Repolho	156.932	1	31.5	156.932	1
6	6	Maracujá	18.35	1	31.5	18.35	1
7	1	Pimentão	8.3	10	31.5	83	2
8	2	Ponta de Peito	28.9	5	45.34	144.5	2
9	3	Pão Francês	32.99	2	32	65.98	2
10	4	Rúcula	5.45	3	31.5	16.35	2
11	5	Repolho	156.932	2	31.5	313.864	2
12	6	Maracujá	18.35	8	31.5	146.8	2
\.


--
-- Data for Name: users; Type: TABLE DATA; Schema: public; Owner: root
--

COPY public.users (usr_id, urs_username, urs_password, urs_name) FROM stdin;
1	edimilson	senha@123	Edimilson Assis
\.


--
-- Name: products_id_seq; Type: SEQUENCE SET; Schema: public; Owner: root
--

SELECT pg_catalog.setval('public.products_id_seq', 6, true);


--
-- Name: sales_id_ite_seq; Type: SEQUENCE SET; Schema: public; Owner: root
--

SELECT pg_catalog.setval('public.sales_id_ite_seq', 12, true);


--
-- Name: sales_id_seq; Type: SEQUENCE SET; Schema: public; Owner: root
--

SELECT pg_catalog.setval('public.sales_id_seq', 2, true);


--
-- Name: type_id_seq; Type: SEQUENCE SET; Schema: public; Owner: root
--

SELECT pg_catalog.setval('public.type_id_seq', 7, true);


--
-- Name: users_id_seq; Type: SEQUENCE SET; Schema: public; Owner: root
--

SELECT pg_catalog.setval('public.users_id_seq', 1, true);


--
-- Name: products products_pkey; Type: CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.products
    ADD CONSTRAINT products_pkey PRIMARY KEY (prd_id);


--
-- Name: sales_items sales_itens_pkey; Type: CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.sales_items
    ADD CONSTRAINT sales_itens_pkey PRIMARY KEY (sls_ite_id);


--
-- Name: sales sales_pkey; Type: CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.sales
    ADD CONSTRAINT sales_pkey PRIMARY KEY (sls_id);


--
-- Name: products_types type_pkey; Type: CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.products_types
    ADD CONSTRAINT type_pkey PRIMARY KEY (tpo_id);


--
-- Name: users users_pkey; Type: CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_pkey PRIMARY KEY (usr_id);


--
-- Name: sales_items trigger_update_sale_total_price; Type: TRIGGER; Schema: public; Owner: root
--

CREATE TRIGGER trigger_update_sale_total_price AFTER INSERT OR UPDATE ON public.sales_items FOR EACH ROW EXECUTE FUNCTION public.update_sale_total_price();


--
-- Name: products products_prd_id_type_fkey; Type: FK CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.products
    ADD CONSTRAINT products_prd_id_type_fkey FOREIGN KEY (prd_id_type) REFERENCES public.products_types(tpo_id);


--
-- Name: products products_prd_id_user_fkey; Type: FK CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.products
    ADD CONSTRAINT products_prd_id_user_fkey FOREIGN KEY (prd_id_user) REFERENCES public.users(usr_id);


--
-- Name: products_types products_types_tpo_id_user_fkey; Type: FK CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.products_types
    ADD CONSTRAINT products_types_tpo_id_user_fkey FOREIGN KEY (tpo_id_user) REFERENCES public.users(usr_id);


--
-- Name: sales_items sales_items_sls_ite_id_sale_fkey; Type: FK CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.sales_items
    ADD CONSTRAINT sales_items_sls_ite_id_sale_fkey FOREIGN KEY (sls_ite_id_sale) REFERENCES public.sales(sls_id);


--
-- Name: sales_items sales_itens_sls_ite_id_product_fkey; Type: FK CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.sales_items
    ADD CONSTRAINT sales_itens_sls_ite_id_product_fkey FOREIGN KEY (sls_ite_id_product) REFERENCES public.products(prd_id);


--
-- Name: sales sales_sls_id_user_fkey; Type: FK CONSTRAINT; Schema: public; Owner: root
--

ALTER TABLE ONLY public.sales
    ADD CONSTRAINT sales_sls_id_user_fkey FOREIGN KEY (sls_id_user) REFERENCES public.users(usr_id);


--
-- PostgreSQL database dump complete
--

